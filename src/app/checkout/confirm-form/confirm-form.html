<div class="bg-lime-300">
  <app-progress-indicator [currentStep]="2"></app-progress-indicator>
</div>

<section class="bg-black py-16">
  <div class="flex justify-center px-6">

    <div class="form w-full max-w-4xl">

      <h2 class="text-2xl font-bold text-white text-center mb-6">
        Your Details
      </h2>

      <form [formGroup]="userForm"
            (ngSubmit)="onSubmit()"
            class="space-y-6">

        <div formGroupName="names"
             class="grid grid-cols-1 md:grid-cols-2 gap-4">

          <div>
            <label class="block font-medium text-white mb-1">First Name</label>
            <div class="inputForm">
              <input type="text"
                     placeholder="First-Name"
                     class="input"
                     formControlName="firstName">
            </div>
            @if(userForm.get('names.firstName')?.touched && userForm.get('names.firstName')?.invalid) {
            <p class="text-red-400 text-sm mt-1">First name is required.</p>
            }
          </div>

          <div>
            <label class="block font-medium text-white mb-1">Last Name</label>
            <div class="inputForm">
              <input type="text"
                     class="input"
                     placeholder="Last-Name"
                     formControlName="lastName">
            </div>
            @if(userForm.get('names.lastName')?.touched && userForm.get('names.lastName')?.invalid) {
            <p class="text-red-400 text-sm mt-1">Last name is required.</p>
            }
          </div>

        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

          <div>
            <label class="block font-medium text-white mb-1">Phone No.</label>
            <div class="inputForm">
              <input type="tel"
                     class="input"
                     placeholder="Phone-No"
                     formControlName="phone">
            </div>
            @if(userForm.get('phone')?.touched && userForm.get('phone')?.invalid) {
            <p class="text-red-400 text-sm mt-1">Phone number is required.</p>
            }
          </div>

          <div>
            <label class="block font-medium text-white mb-1">Email</label>
            <div class="inputForm">
              <input type="email"
                     class="input"
                     placeholder="Email"
                     formControlName="email">
            </div>
            @if(userForm.get('email')?.touched && userForm.get('email')?.errors?.['required']) {
            <p class="text-red-400 text-sm mt-1">Email is required.</p>
            }
            @if(userForm.get('email')?.touched && userForm.get('email')?.errors?.['email']) {
            <p class="text-red-400 text-sm mt-1">Enter a valid email.</p>
            }
          </div>

        </div>

        <div>
          <label class="block font-medium text-white mb-1">Address</label>
          <div class="inputForm">
            <input type="text"
                   class="input"
                   placeholder="Full-Address"
                   formControlName="address">
          </div>
          @if(userForm.get('address')?.touched && userForm.get('address')?.invalid) {
          <p class="text-red-400 text-sm mt-1">Address is required.</p>
          }
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

          <div appDropdownDirective>
            <label class="block font-medium text-white mb-1">City</label>
            <div class="custom-select inputForm"
                 (click)="toggleDropdown('city')">
              {{ userForm.get('city')?.value || 'Select City' }}
            </div>
            @if(openDropdown === 'city') {
            <ul class="dropdown-menu">
              @for(c of city; track $index) {
              <li (click)="selectOption('city', c)">{{ c }}</li>
              }
            </ul>
            }
            @if(userForm.get('city')?.touched && userForm.get('city')?.invalid) {
            <p class="text-red-400 text-sm mt-1">City is required.</p>
            }
          </div>

          <div appDropdownDirective>
            <label class="block font-medium text-white mb-1">State</label>
            <div class="custom-select inputForm"
                 (click)="toggleDropdown('state')">
              {{ userForm.get('state')?.value || 'Select State' }}
            </div>
            @if(openDropdown === 'state') {
            <ul class="dropdown-menu">
              @for(s of state; track $index) {
              <li (click)="selectOption('state', s)">{{ s }}</li>
              }
            </ul>
            }
            @if(userForm.get('state')?.touched && userForm.get('state')?.invalid) {
            <p class="text-red-400 text-sm mt-1">State is required.</p>
            }
          </div>

          <div>
            <label class="block font-medium text-white mb-1">Pincode</label>
            <div class="inputForm">
              <input type="text"
                     class="input"
                     formControlName="pincode">
            </div>
            @if(userForm.get('pincode')?.touched && userForm.get('pincode')?.invalid) {
            <p class="text-red-400 text-sm mt-1">Pincode is required.</p>
            }
          </div>

        </div>

        <div>
          <label class="block font-medium text-white mb-1">Upload Govt Document</label>
          <div class="inputForm">
            <input type="file"
                   class="input"
                   (change)="onFileSelected($event)">
          </div>
          @if(userForm.get('documentFile')?.touched && userForm.get('documentFile')?.invalid) {
          <p class="text-red-400 text-sm mt-1">Document upload is required.</p>
          }
        </div>

        <div>
          <label class="block font-medium text-white mb-1">Delivery Type</label>
          <p class="text-white font-semibold">{{ deliveryType }}</p>
        </div>

        <div>
          <label class="block font-medium text-white mb-1">Driver Needed?</label>
          <div class="flex gap-6 text-white">
            <label class="flex items-center gap-2">
              <input type="radio"
                     formControlName="driverNeeded"
                     [value]="true"> Yes
            </label>
            <label class="flex items-center gap-2">
              <input type="radio"
                     formControlName="driverNeeded"
                     [value]="false"> No
            </label>
          </div>

          @if(driverFeeMessage) {
          <p class="text-yellow-300 bg-yellow-900/30 p-2 rounded-md mt-2">
            {{ driverFeeMessage }}
          </p>
          }

          @if(userForm.get('driverNeeded')?.touched && userForm.get('driverNeeded')?.invalid) {
          <p class="text-red-400 text-sm mt-1">Please choose an option.</p>
          }
        </div>

        <div>
          <label class="flex items-center gap-2 text-white">
            <input type="checkbox"
                   formControlName="agree">
            I agree to terms & conditions and extra charges if any
          </label>
          @if(userForm.get('agree')?.touched && userForm.get('agree')?.invalid) {
          <p class="text-red-400 text-sm mt-1">You must agree before continuing.</p>
          }
        </div>

        <div class="flex justify-center">
          <button type="submit"
                  class="button-submit"
                  [disabled]="userForm.invalid">
            Confirm Booking
          </button>
        </div>

      </form>
    </div>

  </div>
</section>